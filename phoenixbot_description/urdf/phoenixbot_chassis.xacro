<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="phoenixbot_chassis">
    <xacro:macro name="wheel" params="pos side">
      <link name="${side}_${pos}_wheel">
            <visual>
              <xacro:if value="${side == 'right'}">
                <origin rpy="0 0 ${pi}"/>
              </xacro:if>

              <xacro:if value="${pos == 'front' or pos=='back'}">
                <geometry>
                  <mesh filename = "package://phoenixbot_description/meshes/2019/outer_wheel.dae" scale="0.01 0.01 0.01"/>
                </geometry>
              </xacro:if>

              <xacro:if value="${pos == 'center'}">
                <geometry>
                  <mesh filename = "package://phoenixbot_description/meshes/2019/center_wheel.dae" scale="0.01 0.01 0.01"/>
                </geometry>
              </xacro:if>
            </visual>

            <collision>
                <origin rpy="${pi/2} 0 0"/>
                <geometry>
                    <cylinder length="${1 * IN}" radius="${3 * IN}"/>
                </geometry>
            </collision>

            <xacro:cylinder_inertia mass="${0.31 * LBS}" radius="${3 * IN}" thickness="${1 * IN}"/>
        </link>
	</xacro:macro>

  <link name="imu_link"/>
  <joint name = "imu_joint" type="fixed">
      <parent link="base_link"/>
      <child link="imu_link"/>
      <origin xyz="${-1.5 * IN} ${-2 * IN} 0"/>
  </joint>

    <link name="base_link"/>
    <link name="base_footprint"/>

    <joint name = "base_link_joint" type="fixed">
        <parent link="base_link"/>
        <child link="chassis"/>
        <origin xyz="0 0 -0.0212"/>
    </joint>

    <joint name = "base_footprint_joint" type="fixed">
        <parent link="chassis"/>
        <child link="base_footprint"/>
        <origin xyz="0 0 ${-3 * IN}"/>
    </joint>

    <link name="superstructure">
        <visual>
            <geometry>
              <mesh filename = "package://phoenixbot_description/meshes/2019/superstructure.dae" scale="0.01 0.01 0.01"/>
            </geometry>
        </visual>
    </link>
    <joint name = "superstructure_joint" type="fixed">
        <parent link="chassis"/>
        <child link="superstructure"/>
        <origin xyz="0 0 0.0755"/>
    </joint>

    <link name="chassis">
        <visual>
            <geometry>
              <mesh filename = "package://phoenixbot_description/meshes/2019/chassis.dae" scale="0.01 0.01 0.01"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 0.03"/>
            <geometry>
                <box size="0.7108 0.7190 0.0866"/>
            </geometry>
        </collision>

        <inertial>pi
            <mass value="${15 * LBS}"/>
            <inertia ixx="${1/12*15*LBS*((3.33*IN)**2+(28.31*IN)**2)}"
                iyy="${1/12*15*LBS*((27.50*IN)**2+(28.31*IN)**2)}"
                izz="${1/12*15*LBS*((27.50*IN)**2+(3.33*IN)**2)}"
            ixy="0" ixz="0" iyz="0"/>
        </inertial>
    </link>

    <!-- Left wheels -->
    <xacro:wheel side="left" pos="center"/>
    <xacro:wheel side="left" pos="front"/>
    <xacro:wheel side="left" pos="back"/>

    <joint name="left_wheel_joint" type="continuous">
        <axis xyz="0 1 0"/>
        <origin xyz="0 0.3012 0.0"/>
        <parent link="chassis"/>
        <child link="left_center_wheel"/>
    </joint>

    <joint name="left_front_wheel_joint" type="continuous">
        <axis xyz="0 1 0"/>
        <origin xyz="0.2725 0.3057 0.0003556"/>
        <parent link="chassis"/>
        <child link="left_front_wheel"/>
        <mimic joint="left_wheel_joint"/>
    </joint>

    <joint name="left_back_wheel_joint" type="continuous">
        <axis xyz="0 1 0"/>
        <origin xyz="-0.2725 0.3057 0.0003556"/>
        <parent link="chassis"/>
        <child link="left_back_wheel"/>
        <mimic joint="left_wheel_joint"/>
    </joint>

    <transmission name="left_wheel_transmission">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="left_wheel_joint">
            <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
        </joint>
        <actuator name="left_motor">
            <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
            <mechanicalReduction>1</mechanicalReduction>
        </actuator>
    </transmission>

    <!-- Right wheels -->
    <xacro:wheel side="right" pos="center"/>
    <xacro:wheel side="right" pos="front"/>
    <xacro:wheel side="right" pos="back"/>

    <joint name="right_wheel_joint" type="continuous">
        <axis xyz="0 1 0"/>
        <origin xyz="0 -0.3012 0.0"/>
        <parent link="chassis"/>
        <child link="right_center_wheel"/>
    </joint>

    <joint name="right_front_wheel_joint" type="continuous">
        <axis xyz="0 1 0"/>
        <origin xyz="0.2725 -0.3057 0.0003556"/>
        <parent link="chassis"/>
        <child link="right_front_wheel"/>
        <mimic joint="right_wheel_joint"/>
    </joint>

    <joint name="right_back_wheel_joint" type="continuous">
        <axis xyz="0 1 0"/>
        <origin xyz="-0.2725 -0.3057 0.0003556"/>
        <parent link="chassis"/>
        <child link="right_back_wheel"/>
        <mimic joint="right_wheel_joint"/>
    </joint>

    <transmission name="right_wheel_transmission">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="right_wheel_joint">
            <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
        </joint>
        <actuator name="right_motor">
            <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
            <mechanicalReduction>1</mechanicalReduction>
		</actuator>
	</transmission>

</robot>

